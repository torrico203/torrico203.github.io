<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>간단한 게시판</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        padding: 2rem;
        box-sizing: border-box;
      }
      .main-layout {
        display: flex;
        width: 100%;
        max-width: 1200px; /* 전체 레이아웃 최대 너비 증가 */
        background-color: #ffffff;
        border-radius: 1rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        overflow: hidden; /* Ensure rounded corners apply */
      }
      .sidebar {
        width: 280px; /* 사이드바 고정 너비 */
        background-color: #f9fafb;
        padding: 2rem;
        border-right: 1px solid #e5e7eb;
        flex-shrink: 0; /* 사이드바가 줄어들지 않도록 */
        overflow-y: auto; /* 사이드바 내용이 길어지면 스크롤 */
      }
      .content-area {
        flex-grow: 1; /* 남은 공간 모두 차지 */
        padding: 2rem;
        overflow-y: auto; /* 게시물 내용이 길어지면 스크롤 */
      }
      .post-card {
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        margin-bottom: 1rem;
        padding: 1.25rem;
        background-color: #f9fafb;
        transition: all 0.3s ease-in-out;
        overflow: hidden;
      }
      .post-card.expanded {
        background-color: #ffffff;
        border-color: #6366f1; /* Indigo-500 */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      .post-subtitle-summary {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block; /* block으로 변경하여 부모 너비에 맞게 조절 */
      }
      .toggle-button {
        width: 32px;
        height: 32px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1;
      }
      .sidebar-item {
        padding: 0.75rem 0.5rem;
        cursor: pointer;
        border-radius: 0.5rem;
        margin-bottom: 0.5rem;
        transition: background-color 0.2s ease-in-out;
      }
      .sidebar-item:hover {
        background-color: #eef2ff; /* Indigo-50 */
        color: #4f46e5; /* Indigo-600 */
      }
      .sidebar-item.active {
        background-color: #e0e7ff; /* Indigo-100 */
        color: #4338ca; /* Indigo-700 */
        font-weight: 600;
      }

      /* 버튼 컨테이너를 위한 새로운 CSS 클래스 */
      .action-buttons-wrapper {
        display: flex;
        gap: 0.5rem; /* space-x-2 대신 */
        align-items: center;
        margin-left: 1rem; /* ml-4 대신 */
        flex-shrink: 0; /* 축소되지 않도록 */
        min-width: 130px; /* 버튼들이 보일 수 있는 최소 너비 확보 */
        justify-content: flex-end; /* 버튼들을 오른쪽으로 정렬 */
      }
      /* titleAndSubtitleContainer에 min-width: 0; 추가 */
      .title-subtitle-container {
        flex: 1;
        min-width: 0; /* flex item이 내용보다 작아질 수 있도록 허용 */
        padding-right: 1rem; /* 버튼과의 간격 유지 */
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .main-layout {
          flex-direction: column; /* 세로로 쌓이도록 변경 */
        }
        .sidebar {
          width: 100%; /* 모바일에서 사이드바 전체 너비 */
          border-right: none;
          border-bottom: 1px solid #e5e7eb; /* 하단 경계선 추가 */
          max-height: 200px; /* 모바일에서 사이드바 높이 제한 */
        }
        .content-area {
          padding-top: 1rem; /* 모바일에서 상단 패딩 조정 */
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 p-8">
    <div class="main-layout">
      <!-- 사이드바 -->
      <div class="sidebar">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">게시물 목록</h2>
        <div id="sidebar-posts-list">
          <!-- Sidebar titles will be rendered here -->
        </div>
      </div>

      <!-- 메인 콘텐츠 영역 -->
      <div class="content-area">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">
          간단한 게시판
        </h1>

        <!-- 새 글 추가 폼 -->
        <div class="mb-8 p-6 bg-indigo-50 rounded-lg shadow-md">
          <h2 class="text-2xl font-semibold text-indigo-700 mb-4">
            새 글 추가
          </h2>
          <form id="add-post-form" class="space-y-4">
            <div>
              <label
                for="post-title"
                class="block text-sm font-medium text-gray-700 mb-1"
                >제목</label
              >
              <input
                type="text"
                id="post-title"
                name="title"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
              />
            </div>
            <div>
              <label
                for="post-subtitle"
                class="block text-sm font-medium text-gray-700 mb-1"
                >부제목</label
              >
              <input
                type="text"
                id="post-subtitle"
                name="subtitle"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
              />
            </div>
            <div>
              <label
                for="post-content"
                class="block text-sm font-medium text-gray-700 mb-1"
                >내용</label
              >
              <textarea
                id="post-content"
                name="content"
                rows="5"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
              ></textarea>
            </div>
            <button
              type="submit"
              class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out"
            >
              게시물 추가
            </button>
          </form>
        </div>

        <!-- 게시물 목록 -->
        <div id="posts-list">
          <!-- Posts will be rendered here by JavaScript -->
        </div>
      </div>
    </div>

    <script>
      // 게시물 데이터를 저장할 배열
      let posts = [];

      // 부제목 최대 길이 설정 (글자수)
      const MAX_SUBTITLE_LENGTH = 70; // 적절한 길이로 조정 가능

      // 초기 게시물 데이터 (예시)
      posts.push({
        id: Date.now() + 1,
        title: "첫 번째 게시물",
        subtitle:
          "이것은 첫 번째 게시물의 부제목입니다. 요약 모드에서 어떻게 보이는지 테스트하기 위한 예시입니다.",
        content:
          "안녕하세요! 이 게시판 앱에 오신 것을 환영합니다. 이 게시물은 확장된 상태에서 모든 내용을 보여줍니다.",
        expanded: false, // 기본적으로 요약 상태
        isEditing: false, // 수정 모드 상태 추가
      });
      posts.push({
        id: Date.now() + 2,
        title: "두 번째 게시물",
        subtitle: "두 번째 게시물의 짧은 부제목입니다.",
        content:
          "이것은 두 번째 게시물의 내용입니다. 게시물을 클릭하여 내용을 펼치거나 접을 수 있습니다.",
        expanded: false,
        isEditing: false,
      });
      posts.push({
        id: Date.now() + 3,
        title: "세 번째 게시물: 긴 내용 테스트",
        subtitle:
          "세 번째 게시물의 부제목입니다. 이 부제목은 요약 모드에서 잘리는지 확인하기 위해 충분히 길게 작성되었습니다.",
        content:
          "이 게시물은 내용이 꽤 깁니다. 게시물을 확장하면 모든 내용을 볼 수 있습니다. " +
          "게시물 내용이 길어지면 스크롤이 생길 수 있습니다. " +
          "사용자는 필요한 정보를 쉽게 찾을 수 있도록 게시물을 확장하거나 접을 수 있습니다. " +
          "이것은 게시판의 핵심 기능 중 하나입니다. " +
          "새로운 게시물을 추가하여 이 기능을 직접 테스트해 보세요!",
        expanded: false,
        isEditing: false,
      });

      // DOM 요소 가져오기
      const postsList = document.getElementById("posts-list");
      const sidebarPostsList = document.getElementById("sidebar-posts-list");
      const addPostForm = document.getElementById("add-post-form");

      /**
       * 주어진 텍스트를 최대 길이에 따라 자르고 '...'을 추가합니다.
       * Truncates the given text to a maximum length and adds '...'.
       * @param {string} text - 원본 텍스트. Original text.
       * @param {number} maxLength - 최대 길이. Maximum length.
       * @returns {string} 잘린 텍스트. Truncated text.
       */
      function getTruncatedSubtitle(text, maxLength) {
        if (text.length > maxLength) {
          return text.substring(0, maxLength - 3) + "...";
        }
        return text;
      }

      /**
       * 단일 게시물 DOM 요소를 생성하고 반환합니다.
       * Creates and returns a single post DOM element.
       * @param {object} post - 게시물 데이터 객체. Post data object.
       * @returns {HTMLElement} 생성된 게시물 카드 요소. Created post card element.
       */
      function createPostElement(post) {
        const postCard = document.createElement("div");
        postCard.id = `post-${post.id}`;
        postCard.classList.add("post-card", "relative", "overflow-hidden");

        if (post.expanded) {
          postCard.classList.add("expanded");
        }

        const header = document.createElement("div");
        header.classList.add("flex", "justify-between", "items-start", "mb-2");

        const titleAndSubtitleContainer = document.createElement("div");
        titleAndSubtitleContainer.classList.add("title-subtitle-container"); // 새 CSS 클래스 적용

        if (post.isEditing) {
          // Editing mode: show input fields
          const titleInput = document.createElement("input");
          titleInput.type = "text";
          titleInput.id = `edit-title-${post.id}`;
          titleInput.value = post.title;
          titleInput.classList.add(
            "w-full",
            "bg-gray-50",
            "border",
            "border-gray-300",
            "rounded-md",
            "p-1",
            "text-xl",
            "font-semibold",
            "text-gray-900",
            "mb-1"
          );
          titleAndSubtitleContainer.appendChild(titleInput);

          const subtitleInput = document.createElement("input");
          subtitleInput.type = "text";
          subtitleInput.id = `edit-subtitle-${post.id}`;
          subtitleInput.value = post.subtitle;
          subtitleInput.classList.add(
            "w-full",
            "bg-gray-50",
            "border",
            "border-gray-300",
            "rounded-md",
            "p-1",
            "text-gray-600",
            "text-sm"
          );
          titleAndSubtitleContainer.appendChild(subtitleInput);
        } else {
          // Display mode: show text
          const title = document.createElement("h2");
          title.classList.add(
            "text-xl",
            "font-semibold",
            "text-gray-900",
            "mb-1"
          );
          title.textContent = post.title;
          titleAndSubtitleContainer.appendChild(title);

          const subtitle = document.createElement("p");
          subtitle.classList.add("text-gray-600", "text-sm");

          // Apply truncation only in summary mode
          if (!post.expanded) {
            subtitle.classList.add("post-subtitle-summary");
            subtitle.textContent = getTruncatedSubtitle(
              post.subtitle,
              MAX_SUBTITLE_LENGTH
            );
          } else {
            subtitle.textContent = post.subtitle;
          }
          titleAndSubtitleContainer.appendChild(subtitle);
        }
        header.appendChild(titleAndSubtitleContainer);

        const actionButtonsContainer = document.createElement("div");
        actionButtonsContainer.classList.add("action-buttons-wrapper");

        if (post.isEditing) {
          const saveButton = document.createElement("button");
          saveButton.classList.add(
            "bg-green-600",
            "text-white",
            "py-1",
            "px-3",
            "rounded-md",
            "hover:bg-green-700",
            "focus:outline-none",
            "focus:ring-2",
            "focus:ring-offset-2",
            "focus:ring-green-500",
            "transition"
          );
          saveButton.textContent = "저장";
          saveButton.addEventListener("click", () => savePost(post.id));
          actionButtonsContainer.appendChild(saveButton);

          const cancelButton = document.createElement("button");
          cancelButton.classList.add(
            "bg-red-600",
            "text-white",
            "py-1",
            "px-3",
            "rounded-md",
            "hover:bg-red-700",
            "focus:outline-none",
            "focus:ring-2",
            "focus:ring-offset-2",
            "focus:ring-red-500",
            "transition"
          );
          cancelButton.textContent = "취소";
          cancelButton.addEventListener("click", () => cancelEdit(post.id));
          actionButtonsContainer.appendChild(cancelButton);
        } else {
          const editButton = document.createElement("button");
          editButton.classList.add(
            "bg-blue-100",
            "text-blue-600",
            "py-1",
            "px-3",
            "rounded-md",
            "hover:bg-blue-200",
            "focus:outline-none",
            "focus:ring-2",
            "focus:ring-offset-2",
            "focus:ring-blue-500",
            "transition"
          );
          editButton.textContent = "수정";
          editButton.addEventListener("click", () => toggleEdit(post.id));
          actionButtonsContainer.appendChild(editButton);
        }

        // Toggle button (for expand/collapse) - Always present
        const toggleButton = document.createElement("button");
        toggleButton.classList.add(
          "toggle-button",
          "bg-indigo-100",
          "text-indigo-600",
          "rounded-full",
          "hover:bg-indigo-200",
          "focus:outline-none",
          "focus:ring-2",
          "focus:ring-indigo-500",
          "focus:ring-offset-2",
          "transition",
          "duration-150",
          "ease-in-out"
        );
        toggleButton.textContent = post.expanded ? "-" : "+";
        toggleButton.addEventListener("click", () => togglePost(post.id));
        actionButtonsContainer.appendChild(toggleButton);

        header.appendChild(actionButtonsContainer);
        postCard.appendChild(header);

        const contentContainer = document.createElement("div");
        contentContainer.classList.add(
          "text-gray-700",
          "text-base",
          "mt-4",
          "leading-relaxed"
        );
        if (!post.expanded && !post.isEditing) {
          contentContainer.classList.add("hidden");
        }

        if (post.isEditing) {
          const contentTextarea = document.createElement("textarea");
          contentTextarea.id = `edit-content-${post.id}`;
          contentTextarea.rows = 5;
          contentTextarea.value = post.content;
          contentTextarea.classList.add(
            "w-full",
            "bg-gray-50",
            "border",
            "border-gray-300",
            "rounded-md",
            "p-2",
            "text-base"
          );
          contentContainer.appendChild(contentTextarea);
        } else {
          contentContainer.textContent = post.content;
        }
        postCard.appendChild(contentContainer);

        return postCard;
      }

      /**
       * 모든 게시물을 렌더링합니다.
       * Renders all posts.
       */
      function renderPosts() {
        postsList.innerHTML = ""; // Clear existing post list
        posts.forEach((post) => {
          postsList.appendChild(createPostElement(post));
        });
        renderSidebar(); // Update sidebar after rendering posts
      }

      /**
       * 사이드바를 렌더링합니다.
       * Renders the sidebar.
       */
      function renderSidebar() {
        sidebarPostsList.innerHTML = ""; // Clear existing sidebar list

        posts.forEach((post) => {
          const sidebarItem = document.createElement("div");
          sidebarItem.classList.add(
            "sidebar-item",
            "text-gray-700",
            "font-medium"
          );
          sidebarItem.textContent = post.title;
          sidebarItem.dataset.postId = post.id; // Store post ID

          sidebarItem.addEventListener("click", () => {
            // Remove active class from all sidebar items
            document.querySelectorAll(".sidebar-item").forEach((item) => {
              item.classList.remove("active");
            });
            // Add active class to the clicked item
            sidebarItem.classList.add("active");

            const targetPost = document.getElementById(`post-${post.id}`);
            if (targetPost) {
              targetPost.scrollIntoView({ behavior: "smooth", block: "start" });
            }
          });
          sidebarPostsList.appendChild(sidebarItem);
        });
      }

      /**
       * 특정 게시물의 확장/요약 상태를 토글합니다.
       * Toggles the expanded/summary state of a specific post.
       * @param {number} id - 토글할 게시물의 ID. ID of the post to toggle.
       */
      function togglePost(id) {
        const postIndex = posts.findIndex((p) => p.id === id);
        if (postIndex > -1) {
          // Disable toggle functionality when in edit mode
          if (posts[postIndex].isEditing) {
            return;
          }
          posts[postIndex].expanded = !posts[postIndex].expanded;
          renderPosts(); // Re-render after state change
        }
      }

      /**
       * 게시물 수정 모드를 토글합니다.
       * Toggles the edit mode of a post. If another post is being edited, its edit mode is disabled.
       * @param {number} id - 수정 모드를 토글할 게시물의 ID. ID of the post to toggle edit mode.
       */
      function toggleEdit(id) {
        // If there's a currently editing post, disable its edit mode.
        const currentlyEditingPost = posts.find((p) => p.isEditing);
        if (currentlyEditingPost && currentlyEditingPost.id !== id) {
          currentlyEditingPost.isEditing = false;
        }

        const postIndex = posts.findIndex((p) => p.id === id);
        if (postIndex > -1) {
          posts[postIndex].isEditing = !posts[postIndex].isEditing; // Toggle edit mode
          // If entering edit mode, expand the post if it's not already expanded
          if (posts[postIndex].isEditing && !posts[postIndex].expanded) {
            posts[postIndex].expanded = true;
          }
          renderPosts();
        }
      }

      /**
       * 게시물 내용을 저장합니다.
       * Saves the post content.
       * @param {number} id - 저장할 게시물의 ID. ID of the post to save.
       */
      function savePost(id) {
        const postIndex = posts.findIndex((p) => p.id === id);
        if (postIndex > -1) {
          const titleInput = document.getElementById(`edit-title-${id}`);
          const subtitleInput = document.getElementById(`edit-subtitle-${id}`);
          const contentInput = document.getElementById(`edit-content-${id}`);

          if (titleInput && subtitleInput && contentInput) {
            posts[postIndex].title = titleInput.value;
            posts[postIndex].subtitle = subtitleInput.value;
            posts[postIndex].content = contentInput.value;
            posts[postIndex].isEditing = false; // Exit edit mode
            renderPosts();
          }
        }
      }

      /**
       * 게시물 수정을 취소합니다.
       * Cancels post editing.
       * @param {number} id - 수정을 취소할 게시물의 ID. ID of the post to cancel editing.
       */
      function cancelEdit(id) {
        const postIndex = posts.findIndex((p) => p.id === id);
        if (postIndex > -1) {
          posts[postIndex].isEditing = false; // Exit edit mode (do not save)
          renderPosts();
        }
      }

      /**
       * 새 게시물을 추가합니다.
       * Adds a new post.
       * @param {Event} event - 폼 제출 이벤트 객체. Form submission event object.
       */
      addPostForm.addEventListener("submit", (event) => {
        event.preventDefault();

        const titleInput = document.getElementById("post-title");
        const subtitleInput = document.getElementById("post-subtitle");
        const contentInput = document.getElementById("post-content");

        const newPost = {
          id: Date.now(),
          title: titleInput.value,
          subtitle: subtitleInput.value, // Use the actual subtitle input
          content: contentInput.value,
          expanded: false, // New posts are in summary state by default
          isEditing: false, // New posts are not in edit mode by default
        };

        posts.unshift(newPost); // Add to the beginning of the post list
        renderPosts(); // Re-render post list and sidebar

        // Clear form fields
        titleInput.value = "";
        subtitleInput.value = "";
        contentInput.value = "";
      });

      // Render posts on page load
      document.addEventListener("DOMContentLoaded", () => {
        renderPosts();
        renderSidebar(); // Render sidebar on initial load
      });
    </script>
  </body>
</html>
